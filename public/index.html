<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Signalk waypoint form update</title>
    <script>

      //function to handle for submit
      function formSubmit(){
        //endpoint url for waypoint using user entered location
        //https://demo.signalk.org/documentation/Developing/REST_APIs/Course_API.html#1-navigate-to-a-location
        const url = "/signalk/v2/api/vessels/self/navigation/course/destination"
        //retrieve the form data from form
        var form = new FormData(document.getElementById("waypointForm"))
        //create JSON object to send to server, Number() converts string to number
        var data = {
          position:{
            latitude:Number(form.get("latitude")),
            longitude:Number(form.get("longitude"))
          }
        };
        //sanity check print
        console.log(data)
        //Create request handler XHR
        var xhr = new XMLHttpRequest()
        //open the request using PUT method
        xhr.open("PUT", url)
        //set the content type to JSON, refer to MIME type reference below
        //https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/MIME_types/Common_types
        xhr.setRequestHeader("Content-Type","application/json")
        //send the put request (Won't work for me locally)
        // xhr.send(data)
        xhr.send(JSON.stringify(data)); 
        //give a little pop-up letting user know they submitted something
        window.alert("Form sent!")
      }

      //function to set destination to Apex
      function setDestinationA(){
        const url = "/signalk/v2/api/vessels/self/navigation/course/destination"
        var data = {
          href:"/resources/waypoints/f60dbafd-4745-434d-b9d9-52a851224229"
        };
        console.log(data)
        var xhr = new XMLHttpRequest()
        xhr.open("PUT", url)
        xhr.setRequestHeader("Content-Type","application/json")
        xhr.send(JSON.stringify(data));
        document.getElementById("output").innerText = "Destination set to Apex!"

        const url2 = "/signalk/v2/api/resources/routes";
        var data2 = {
          "name": "Apex to Balscadden",
          "waypoints": [
            {
              "href": "/resources/waypoints/f60dbafd-4745-434d-b9d9-52a851224229"
            },
            {
              "href": "/resources/waypoints/5a567b67-01ed-48f1-bad5-c14118fe6c45"
            }
          ]
        };
        console.log(data2)
        var xhr2 = new XMLHttpRequest()
        xhr2.open("POST", url2)
        xhr2.setRequestHeader("Content-Type","application/json")
        xhr2.send(JSON.stringify(data2));
        document.getElementById("output").innerText = "Route set from Apex to Balscadden!";

      }

   function setDestinationB(){
        const url = "/signalk/v2/api/vessels/self/navigation/course/destination"
        var data = {
          href:"/resources/waypoints/5a567b67-01ed-48f1-bad5-c14118fe6c45"
        };
        console.log(data)
        var xhr = new XMLHttpRequest()
        xhr.open("PUT", url)
        xhr.setRequestHeader("Content-Type","application/json")
        xhr.send(JSON.stringify(data));
        document.getElementById("output").innerText = "Destination set to Balscadden!"
      }

  function setDestinationP(){
        const url = "/signalk/v2/api/vessels/self/navigation/course/destination"
        var data = {
          href:"/resources/waypoints/fcc94183-b20d-4c57-8121-e93cbdbb3870"
        };
        console.log(data)
        var xhr = new XMLHttpRequest()
        xhr.open("PUT", url)
        xhr.setRequestHeader("Content-Type","application/json")
        xhr.send(JSON.stringify(data));
        document.getElementById("output").innerText = "Destination set to Portmarnock!"
      }

      function listAllWaypoints(){
        const url = "/signalk/v2/api/resources/waypoints"
        var xhr = new XMLHttpRequest()
        xhr.open("GET", url)
        xhr.setRequestHeader("Content-Type","application/json")
        xhr.onload = function() {
          if (xhr.status === 200) {
            var waypoints = JSON.parse(xhr.responseText);
            console.log(waypoints);
            var output = "Waypoints:\n";
            for (const child of Object.values(waypoints)) {
              waypoints = child;
              console.log(waypoints);
              output += JSON.stringify(waypoints, null, 2);
              break; // Get the first child which contains the waypoints array
            }
            document.getElementById("output").innerText = output;
          } else {
            console.error("Error fetching waypoints: " + xhr.status);
          }
        };
        xhr.send();
      }
    </script>
  </head>
  <body>
    <form id="waypointForm">
      <label for="longitude">longitude:</label>
      <input type="number" name="longitude">
      <label for="latitude">latitude:</label>
      <input type="number" name="latitude">
    </form>
    <button type="submit" onclick="formSubmit()">Submit</button>
    <button id="apexButton" type="submit" onclick="setDestinationA()">Destination Apex</button>
    <button id="balscaddenButton" type="submit" onclick="setDestinationB()">Destination Balscadden</button>
    <button id="portmarnockButton" type="submit" onclick="setDestinationP()">Destination Portmarnock</button>
    <button id="listWaypointsButton" type="submit" onclick="listAllWaypoints()">List All Waypoints</button>
    <div id="output">
      Some Text Here
    </div>
  </body>
</html>
